name: Node.js Packages Build
on:
  push:
    branches:
      - main
jobs:
  build-notification-service-client:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "notification-service-client" ] && exit 0 || cd "notification-service-client"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "notification-service-client" ] && exit 0 || cd "notification-service-client"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "notification-service-client" ] && exit 0 || cd "notification-service-client"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-notification-service-client
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: notification-service-client/diia-inhouse-*.tgz
  build-diia-crypto-client:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "diia-crypto-client" ] && exit 0 || cd "diia-crypto-client"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "diia-crypto-client" ] && exit 0 || cd "diia-crypto-client"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "diia-crypto-client" ] && exit 0 || cd "diia-crypto-client"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-diia-crypto-client
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: diia-crypto-client/diia-inhouse-*.tgz
  build-auth-service-client:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "auth-service-client" ] && exit 0 || cd "auth-service-client"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "auth-service-client" ] && exit 0 || cd "auth-service-client"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "auth-service-client" ] && exit 0 || cd "auth-service-client"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-auth-service-client
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: auth-service-client/diia-inhouse-*.tgz
  build-be-configs:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-configs" ] && exit 0 || cd "be-configs"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-configs" ] && exit 0 || cd "be-configs"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-configs" ] && exit 0 || cd "be-configs"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-configs
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-configs/diia-inhouse-*.tgz
  build-be-eslint-plugin:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-eslint-plugin" ] && exit 0 || cd "be-eslint-plugin"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-eslint-plugin" ] && exit 0 || cd "be-eslint-plugin"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-eslint-plugin" ] && exit 0 || cd "be-eslint-plugin"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-eslint-plugin
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-eslint-plugin/diia-inhouse-*.tgz
  build-be-eslint-config:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-eslint-plugin
      - build-be-configs
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-eslint-config" ] && exit 0 || cd "be-eslint-config"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-eslint-config" ] && exit 0 || cd "be-eslint-config"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-eslint-config" ] && exit 0 || cd "be-eslint-config"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-eslint-config
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-eslint-config/diia-inhouse-*.tgz
  build-be-genproto:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-eslint-config
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-genproto" ] && exit 0 || cd "be-genproto"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-genproto" ] && exit 0 || cd "be-genproto"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-genproto" ] && exit 0 || cd "be-genproto"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-genproto
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-genproto/diia-inhouse-*.tgz
  build-be-types:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-eslint-config
      - build-be-genproto
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-types" ] && exit 0 || cd "be-types"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-types" ] && exit 0 || cd "be-types"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-types" ] && exit 0 || cd "be-types"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-types
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-types/diia-inhouse-*.tgz
  build-be-scaffold:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-eslint-config
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-scaffold" ] && exit 0 || cd "be-scaffold"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-scaffold" ] && exit 0 || cd "be-scaffold"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-scaffold" ] && exit 0 || cd "be-scaffold"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-scaffold
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-scaffold/diia-inhouse-*.tgz
  build-be-pkg-test:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-eslint-config
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-test" ] && exit 0 || cd "be-pkg-test"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-test" ] && exit 0 || cd "be-pkg-test"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-test" ] && exit 0 || cd "be-pkg-test"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-test
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-test/diia-inhouse-*.tgz
  build-be-pkg-i18n:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-i18n" ] && exit 0 || cd "be-pkg-i18n"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-i18n" ] && exit 0 || cd "be-pkg-i18n"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-i18n" ] && exit 0 || cd "be-pkg-i18n"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-i18n
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-i18n/diia-inhouse-*.tgz
  build-be-pkg-errors:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-eslint-config
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-errors" ] && exit 0 || cd "be-pkg-errors"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-errors" ] && exit 0 || cd "be-pkg-errors"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-errors" ] && exit 0 || cd "be-pkg-errors"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-errors
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-errors/diia-inhouse-*.tgz
  build-be-pkg-validators:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-validators" ] && exit 0 || cd "be-pkg-validators"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-validators" ] && exit 0 || cd "be-pkg-validators"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-validators" ] && exit 0 || cd "be-pkg-validators"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-validators
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-validators/diia-inhouse-*.tgz
  build-be-pkg-utils:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
      - build-be-pkg-validators
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-utils" ] && exit 0 || cd "be-pkg-utils"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-utils" ] && exit 0 || cd "be-pkg-utils"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-utils" ] && exit 0 || cd "be-pkg-utils"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-utils
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-utils/diia-inhouse-*.tgz
  build-be-pkg-healthcheck:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
      - build-be-pkg-utils
      - build-be-pkg-validators
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-healthcheck" ] && exit 0 || cd "be-pkg-healthcheck"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-healthcheck" ] && exit 0 || cd "be-pkg-healthcheck"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-healthcheck" ] && exit 0 || cd "be-pkg-healthcheck"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-healthcheck
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-healthcheck/diia-inhouse-*.tgz
  build-be-diia-logger:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-eslint-config
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-diia-logger" ] && exit 0 || cd "be-diia-logger"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-diia-logger" ] && exit 0 || cd "be-diia-logger"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-diia-logger" ] && exit 0 || cd "be-diia-logger"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-diia-logger
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-diia-logger/diia-inhouse-*.tgz
  build-be-pkg-http:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-diia-logger
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-http" ] && exit 0 || cd "be-pkg-http"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-http" ] && exit 0 || cd "be-pkg-http"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-http" ] && exit 0 || cd "be-pkg-http"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-http
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-http/diia-inhouse-*.tgz
  build-be-pkg-env:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-diia-logger
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-env" ] && exit 0 || cd "be-pkg-env"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-env" ] && exit 0 || cd "be-pkg-env"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-env" ] && exit 0 || cd "be-pkg-env"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-env
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-env/diia-inhouse-*.tgz
  build-be-pkg-crypto:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-diia-logger
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
      - build-be-pkg-utils
      - build-be-pkg-validators
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-crypto" ] && exit 0 || cd "be-pkg-crypto"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-crypto" ] && exit 0 || cd "be-pkg-crypto"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-crypto" ] && exit 0 || cd "be-pkg-crypto"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-crypto
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-crypto/diia-inhouse-*.tgz
  build-be-pkg-redis:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-crypto
      - build-be-diia-logger
      - build-be-pkg-env
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
      - build-be-pkg-utils
      - build-be-pkg-validators
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-redis" ] && exit 0 || cd "be-pkg-redis"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-redis" ] && exit 0 || cd "be-pkg-redis"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-redis" ] && exit 0 || cd "be-pkg-redis"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-redis
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-redis/diia-inhouse-*.tgz
  build-be-pkg-db:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-pkg-crypto
      - build-be-pkg-utils
      - build-be-pkg-validators
      - build-be-configs
      - build-be-diia-logger
      - build-be-pkg-env
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-db" ] && exit 0 || cd "be-pkg-db"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-db" ] && exit 0 || cd "be-pkg-db"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-db" ] && exit 0 || cd "be-pkg-db"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-db
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-db/diia-inhouse-*.tgz
  build-be-pkg-cms:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-pkg-http
      - build-be-types
      - build-be-pkg-test
      - build-be-diia-logger
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-cms" ] && exit 0 || cd "be-pkg-cms"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-cms" ] && exit 0 || cd "be-pkg-cms"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-cms" ] && exit 0 || cd "be-pkg-cms"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-cms
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-cms/diia-inhouse-*.tgz
  build-be-pkg-analytics:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-crypto
      - build-be-diia-logger
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-genproto
      - build-be-pkg-test
      - build-be-types
      - build-be-pkg-utils
      - build-be-pkg-validators
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-analytics" ] && exit 0 || cd "be-pkg-analytics"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-analytics" ] && exit 0 || cd "be-pkg-analytics"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-analytics" ] && exit 0 || cd "be-pkg-analytics"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-analytics
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-analytics/diia-inhouse-*.tgz
  build-be-diia-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-crypto
      - build-be-diia-logger
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-pkg-test
      - build-be-types
      - build-be-pkg-utils
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-diia-metrics" ] && exit 0 || cd "be-diia-metrics"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-diia-metrics" ] && exit 0 || cd "be-diia-metrics"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-diia-metrics" ] && exit 0 || cd "be-diia-metrics"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-diia-metrics
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-diia-metrics/diia-inhouse-*.tgz
  build-be-diia-queue:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-crypto
      - build-be-diia-logger
      - build-be-diia-metrics
      - build-be-pkg-env
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-eslint-plugin
      - build-be-pkg-redis
      - build-be-pkg-test
      - build-be-types
      - build-be-pkg-utils
      - build-be-pkg-validators
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-diia-queue" ] && exit 0 || cd "be-diia-queue"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-diia-queue" ] && exit 0 || cd "be-diia-queue"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-diia-queue" ] && exit 0 || cd "be-diia-queue"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-diia-queue
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-diia-queue/diia-inhouse-*.tgz
  build-be-pkg-providers:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-diia-logger
      - build-be-diia-queue
      - build-be-pkg-env
      - build-be-pkg-errors
      - build-be-pkg-redis
      - build-be-types
      - build-be-pkg-utils
      - build-be-pkg-validators
      - build-be-configs
      - build-be-diia-metrics
      - build-be-eslint-config
      - build-be-pkg-test
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-pkg-providers" ] && exit 0 || cd "be-pkg-providers"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-pkg-providers" ] && exit 0 || cd "be-pkg-providers"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-pkg-providers" ] && exit 0 || cd "be-pkg-providers"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-pkg-providers
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-pkg-providers/diia-inhouse-*.tgz
  build-be-diia-app:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-configs
      - build-be-pkg-crypto
      - build-be-pkg-db
      - build-be-diia-logger
      - build-be-diia-metrics
      - build-be-diia-queue
      - build-be-pkg-env
      - build-be-pkg-errors
      - build-be-eslint-config
      - build-be-eslint-plugin
      - build-be-genproto
      - build-be-pkg-healthcheck
      - build-be-pkg-redis
      - build-be-pkg-test
      - build-be-types
      - build-be-pkg-utils
      - build-be-pkg-validators
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-diia-app" ] && exit 0 || cd "be-diia-app"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-diia-app" ] && exit 0 || cd "be-diia-app"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-diia-app" ] && exit 0 || cd "be-diia-app"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-diia-app
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-diia-app/diia-inhouse-*.tgz
  build-be-user-service:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    needs:
      - build-be-pkg-analytics
      - build-be-pkg-crypto
      - build-be-pkg-db
      - build-be-diia-app
      - build-be-diia-logger
      - build-be-diia-metrics
      - build-be-diia-queue
      - build-be-pkg-env
      - build-be-pkg-errors
      - build-be-pkg-healthcheck
      - build-be-pkg-http
      - build-be-pkg-i18n
      - build-be-pkg-redis
      - build-be-types
      - build-be-pkg-utils
      - build-be-pkg-validators
      - build-be-configs
      - build-be-eslint-config
      - build-be-genproto
      - build-be-scaffold
      - build-be-pkg-test
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "be-user-service" ] && exit 0 || cd "be-user-service"
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "be-user-service" ] && exit 0 || cd "be-user-service"
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "be-user-service" ] && exit 0 || cd "be-user-service"
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-be-user-service
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: be-user-service/diia-inhouse-*.tgz
  build-root:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    services:
      verdaccio:
        image: verdaccio/verdaccio
        ports:
          - 4873:4873
        volumes:
          - ${{ github.workspace }}/.github/workflows/verdaccio/conf:/verdaccio/conf
        options: --name verdaccio
    steps:
      - name: Chown user
        run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE
      - uses: actions/checkout@v4
        with:
          submodules: "true"
      - name: Sync submodules configuration
        run: bin/00-initialize.sh --sync
      - name: Restart Verdaccio
        uses: docker://docker
        with:
          args: docker restart verdaccio
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - uses: actions/setup-node@v4
        with:
          node-version: 18.19.1
          registry-url: http://localhost:4873/
      - name: Configure NPM registry to Verdaccio for Package
        run: |-
          rm -rf .npmrc && touch .npmrc
          npm set registry http://localhost:4873/
          npx npm-cli-adduser -u test -p 1234 -e test@domain.test -r http://localhost:4873
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
          [ ! -d "." ] && exit 0 || cd "."
          rm -rf .npmrc && touch .npmrc
          npx npm-cli-login -u test -p 1234 -e test@domain.test -r http://localhost:4873
      - name: Make folder for artifacts
        run: mkdir -p .artifacts
      - uses: actions/download-artifact@v4
        with:
          path: .artifacts
      - name: Publish NPM Package from Artifacts into Verdaccio
        run: |-
          find .artifacts -type f -name "*.tgz" -exec npm publish {} \;
          find diia-setup-howto/backend/clients -type f -name "*.tgz" -exec npm publish {} \;
      - name: Build and Pack
        run: |-
          [ ! -d "." ] && exit 0 || cd "."
          npm install
          npm pack
      - name: Run Unit Testing
        run: |-
          [ ! -d "." ] && exit 0 || cd "."
          npm test --if-present
      - uses: actions/upload-artifact@v4
        with:
          name: artifact-.
          overwrite: true
          compression-level: 0
          retention-days: 5
          path: ./diia-inhouse-*.tgz

